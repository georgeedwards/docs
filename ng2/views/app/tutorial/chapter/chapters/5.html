<h1 id="chapter-5-plugins-and-npm-modules">Chapter 5—Plugins and npm Modules</h1>
<p>As you build more complex apps, you'll likely run into functionality that is not implemented in the NativeScript modules. But no worries, as NativeScript lets you leverage <a href="https://www.npmjs.com/">npm</a> (node package manager) to import npm modules into your apps. Alternately, you can install NativeScript plugins, which are simply npm modules that can access native code and use Android and iOS SDKs, if required. </p>
<p>In this chapter, you'll install and use an external email validator module to verify the format of email addresses as they are entered on the registration screen. Then, you'll add a NativeScript plugin, <a href="https://www.npmjs.com/package/nativescript-social-share">NativeScript social share</a>, to let users share their grocery lists using their device's native sharing widget.</p>
<h2 id="table-of-contents">Table of contents</h2>
<ul>
<li><a href="#51-using-npm-modules">5.1: Using npm modules</a></li>
<li><a href="#52-using-nativescript-plugins">5.2: Using NativeScript plugins</a></li>
</ul>
<h2 id="5-1-using-npm-modules">5.1: Using npm modules</h2>
<p>It would be nice to be able to make sure people are entering well-formatted email addresses into your app on the registration screen. You could write this functionality yourself, but validating email addresses is <a href="http://stackoverflow.com/questions/46155/validate-email-address-in-javascript">surprisingly tricky</a>, and it's a lot easier to use one of many npm modules that already provide this validation. For Groceries let's see how to add this <a href="https://www.npmjs.com/package/email-validator">email-validator module</a> to test for valid addresses.</p>
<div class="exercise-start">
<p><h4><br>    <b>Exercise</b>: Install the email validator module<br></h4>

</p>
<p>Return to your terminal and make sure that you are working in the root directory in your Groceries project folder, a.k.a. here:</p>
<p><div class="no-copy-button"></div>

</p>
<pre><code>sample-Groceries <----------------
    ├── app
    │   └── ...
    ├── package.json
    └── platforms
        ├── android
        └── ios
</code></pre><p>From the root directory install the email-validator module:</p>
<pre><code>npm install email-validator --save
</code></pre></div>

<p>The install process does a few things in the background. First, because you added the <code>--save</code> flag, npm records this dependency in your app's <code>package.json</code>. If you open your <code>package.json</code> you should see <code>"email-validator"</code> in your app's <code>"dependencies"</code> array.</p>
<pre><code class="lang-JavaScript">"dependencies": {
  "email-validator": "^1.0.4""
}
</code></pre>
<p>The npm CLI also creates a <code>node_modules</code> folder in the root of your app. This folder contains the code for the email-validator module, which is a bit of validation logic in <code>node_modules/email_validator/index.js</code>. </p>
<blockquote>
<p><strong>TIP</strong>: By saving your app's npm dependencies in your <code>package.json</code> file, you can always regenerate your <code>node_modules</code> folder by running <code>npm install</code>. Because of this, it's a common practice to exclude the <code>node_modules</code> folder from source control. The Groceries app uses git for source control, and as such includes <code>node_modules/</code> in its <code>.gitignore</code>.</p>
</blockquote>
<p>Now that you have the module installed let's look at how to use it.</p>
<p>
<div class="exercise-start"><h4><br>    <b>Exercise</b>: Use the email validator module<br></h4>

</p>
<p>Open <code>/app/shared/view-models/user-view-model.js</code> and add the following line at the top of the file:</p>
<pre><code class="lang-JavaScript">var validator = require("email-validator"");
</code></pre>
<blockquote>
<p><strong>NOTE</strong>: The NativeScript framework's <code>require()</code> method is configured to look at the <code>"main"</code> value in an npm module's <code>package.json</code> file. In the case of this module, the <code>"main"</code> value is <code>"index.js"</code>. Therefore, when you run <code>require("email-validator"")</code>, you're actually requiring the file at <code>node_modules/email_validator/index.js</code>. You could also type <code>require("email-validator/index"")</code> to retrieve the same file.</p>
</blockquote>
<p>To make use of this validator, add a function to <code>user-view-model.js</code>, right above the line <code>return viewModel</code>:</p>
<pre><code class="lang-JavaScript">viewModel.isValidEmail = function() {
    var email = this.get("email"");
    return validator.validate(email);
};
</code></pre>
<p>Then, edit the registration function in <code>app/views/register/register.js</code> to trap any malformed email addresses:</p>
<pre><code class="lang-JavaScript">exports.register = function() {
    if (user.isValidEmail()) {
        completeRegistration();
    } else {
        dialogsModule.alert({
            message: "Enter a valid email address.",
            okButtonText: "OK""
        });
    }
};
</code></pre>
</div>

<p>In this function, the user submits an email and password, and the value is sent to the view model for validation. If it passes, registration can proceed, otherwise you show an alert. However in order to test out this change you’ll need to do one more thing.</p>
<div class="exercise-start">
<p><h4><br>    <b>Exercise</b>: Rebuild your app<br></h4>

</p>
<p>As we mentioned in chapter 1, although the <code>tns livesync</code> command is smart enough to reload your app for most changes you make to your app, certain changes require a full build—most notably, changes to native files in <code>app/App_Resources</code>, new modules installed with <code>npm install</code>, and new NativeScript plugins.</p>
<p>For NativeScript to recognize this new email-validator npm module, type <code>Ctrl+C</code> in your terminal to kill the existing <code>tns livesync</code> watcher if it’s still running, and then use <code>tns run</code> to rebuild your application and deploy it to an emulator or device.</p>
<pre><code>tns run ios --emulator
</code></pre><p>Or</p>
<pre><code>tns run android --emulator
</code></pre><p>After the app deploys you can again run the <code>livesync</code> command to setup the watcher again.</p>
<pre><code>tns livesync ios --emulator --watch
</code></pre><p>Or</p>
<pre><code>tns livesync android --emulator --watch
</code></pre></div>

<p>After your app launches again, if you attempt to register with an invalid email address, you should see an alert that prevents the submission:</p>
<p><img src="/img/cli-getting-started/nativescript/chapter5/ios/1.png" alt=""><br><img src="/img/cli-getting-started/nativescript/chapter5/android/1.png" alt=""></p>
<p>In general npm modules greatly expand the number of things you're able to do in your NativeScript apps. Need date and time formatting? Use <a href="https://www.npmjs.com/package/moment">moment</a>. Need utility functions for objects and arrays? Use <a href="https://www.npmjs.com/package/lodash">lodash</a> or <a href="https://www.npmjs.com/package/underscore">underscore</a>. This code reuse benefit gets even more powerful when you bring NativeScript plugins into the picture.</p>
<blockquote>
<p><strong>WARNING</strong>: Not all npm modules work in NativeScript apps. Specifically, modules that depend on Node.js or browser APIs will not work, as those APIs do not exist in NativeScript. The NativeScript wiki contains a <a href="https://github.com/NativeScript/NativeScript/wiki/supported-npm-modules">list of some of the more popular npm modules that have been verified to work in NativeScript apps</a>.</p>
</blockquote>
<h2 id="5-2-using-nativescript-plugins">5.2: Using NativeScript plugins</h2>
<p>NativeScript plugins are npm modules that have the added ability to run native code and use iOS and Android frameworks. Because NativeScript plugins are just npm modules, a lot of the techniques you learned in the previous section still apply. The one big difference is in the command you use to install plugins. Let's look at how it works by installing the NativeScript social share plugin.</p>
<div class="exercise-start">
<p><h4><br>    <b>Exercise</b>: Install the social sharing plugin<br></h4>

</p>
<p>Return to your terminal, make sure you're still in the root of your app, and run the following command:</p>
<pre><code>tns plugin add nativescript-social-share
</code></pre></div>

<p>The install process does the same thing that the <code>npm install</code> command does—including retrieving the module from npm, installing the module in <code>node_modules</code>, and saving the module as a dependency in your app's <code>package.json</code>—but the <code>tns plugin add</code> command additionally configures any native code that the plugin needs to use.</p>
<p>For example the <a href="https://github.com/NativeScript/push-plugin">NativeScript push plugin</a> uses both iOS and Android SDKs, and the <code>tns plugin add</code> command takes care of installing those. The <a href="https://github.com/tjvantoll/nativescript-flashlight">NativeScript flashlight plugin</a> needs permissions to use the camera on Android, and the <code>tns plugin add</code> command takes care of setting that up too.</p>
<p>Now that you've installed the social share plugin, let's look at how to use it.</p>
<div class="exercise-start">
<p><h4><br>    <b>Exercise</b>: Use the social sharing plugin<br></h4>

</p>
<p>Open <code>app/views/list/list.js</code> and add the following line at the top of the file, which requires the social share module you just installed:</p>
<pre><code class="lang-JavaScript">var socialShare = require("nativescript-social-share"");
</code></pre>
<p>Next you have to build some UI that lets you share a grocery list. To do so, open <code>app/views/list/list.xml</code> and add the following code below the opening <code><Page></code> tag, and above the opening <code><GridLayout></code> tag.</p>
<pre><code class="lang-XML"><Page.actionBar>
    <ActionBar title="Groceries">
        <ActionBar.actionItems>
            <ActionItem text="Share"" tap="share"" ios.position="right"" />
        </ActionBar.actionItems>
    </ActionBar>
</Page.actionBar>
</code></pre>
<p>This code defines an <a href="/ui/action-bar">ActionBar</a>, which is a UI component that includes various menu items, enclosed in the <code><ActionBar.actionItems></code> tag. The <code>title</code> of the ActionBar lets you show page-specific titles.</p>
<blockquote>
<p><strong>NOTE</strong>: On iOS devices, <code><ActionItem></code>s are placed from left to right in sequence; you can override that (as the code above does) by providing an <code>ios.position</code> attribute.</p>
</blockquote>
<p>With the module installed and required, and the UI in place, you can implement the <code><ActionItem></code>'s tap handler (<code>share()</code>) in the list page's code-behind file.</p>
<p>To do so, return to <code>list.js</code> and paste the following code at the bottom of the file:</p>
<pre><code class="lang-JavaScript">exports.share = function() {
    var list = [];
    var finalList = ";
    for (var i = 0, size = groceryList.length; i < size ; i++) {
        list.push(groceryList.getItem(i).name);
    }
    var listString = list.join(", "").trim();
    socialShare.shareText(listString);
};
</code></pre>
</div>

<p>This code takes the groceries from the grocery list view model, converts the data into a comma-separated string, and passes that string to the social share module's <code>shareText()</code> method.</p>
<blockquote>
<p><strong>WARNING</strong>: Because this section had you install a NativeScript plugin, you’ll have to rebuild your app one last time in order to test your changes. If you don’t remember how refer back to <a href="chapter-5">chapter 5</a> for instructions.</p>
</blockquote>
<p>Now when you run the app, you'll see a new button at the top of the screen. When you tap it, the native iOS or Android sharing widget will show to let you post your groceries to your social networks, or send them via email, message, or any other method you prefer.</p>
<p><img src="/img/cli-getting-started/nativescript/chapter5/ios/2.gif" alt="Social sharing widget on iOS"><br><img src="/img/cli-getting-started/nativescript/chapter5/android/2.gif" alt="Social sharing widget on Android"></p>
<p>Pretty cool, huh? The ability to use npm modules greatly expands the number of things you're able to do in a NativeScript app. Need to compose emails in your app? Try out the <a href="https://www.npmjs.com/package/nativescript-email">NativeScript email plugin</a>. Need to use the clipboard in your app? Try out the <a href="https://www.npmjs.com/package/nativescript-clipboard">NativeScript clipboard plugin</a>.</p>
<p>If you're looking for NativeScript plugins start by searching both the <a href="http://plugins.telerik.com/nativescript">Telerik NativeScript Plugins Marketplace</a> and our <a href="http://plugins.nativescript.rocks">community-curated list of plugins on npm</a>. If you don't find the plugin you need, you can <a href="https://nativescript.ideas.aha.io/">request the plugin on our ideas portal</a>, or you can take a stab at <a href="https://docs.nativescript.org/plugins">creating the plugin yourself</a>.</p>
<p>Between NativeScript modules, npm modules, and NativeScript plugins, the NativeScript framework provides a lot of functionality you can use to build your next app. However, we've yet to talk about NativeScript's most powerful feature: the ability to directly access iOS and Android APIs in JavaScript. Let's look at how it works.</p>
<p><div class="next-chapter-link-container"><br>  <a href="/tutorial/chapter-6">Continue to Chapter 6—Accessing Native APIs</a><br></div></p>